// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
}

datasource db {
  provider          = "postgresql"
  url               = env("DATABASE_URL")
}

model User {
  id                          String        @id @default(uuid())
  email                       String        @unique @db.VarChar(256)
  phone                       String        @unique @db.VarChar(32)
  firstName                   String        @db.VarChar(256)
  lastName                    String        @db.VarChar(256)
  passwordHash                String?
  avatar                      String?       @db.VarChar(2048)
  role                        Role          @default(USER)
  settings                    UserSettings?
  address                     Address?
  socialMedia                 SocialMedia[]
  exposedItems                Product[]     @relation("exposedItems")
  wonItems                    Product[]     @relation("wonItems")
  bids                        Bid[]
  chats                       ChatMember[]
  messages                    Message[]
  createdAt                   DateTime      @default(now())
  updatedAt                   DateTime?     @updatedAt
}

model UserSettings {
  id                          String        @id @default(uuid())
  language                    Languages?    @default(UA)
  theme                       Themes?       @default(LIGHT)
  enableEmailNotifications    Boolean?      @default(true)
  user                        User          @relation(fields: [userId], references: [id])
  userId                      String        @unique
  createdAt                   DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Address {
  id                          String        @id @default(uuid())
  country	                    String?       @db.VarChar(256)
  region                      String?       @db.VarChar(512)
  city                        String?       @db.VarChar(512)
  address	                    String?       @db.VarChar(1024)
  zip                         String?       @db.VarChar(32)
  novaPoshtaRef               String?
  user                        User?         @relation(fields: [userId], references: [id])
  userId                      String?       @unique
  createdAt                   DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model SocialMedia {
  id	                        String        @id @default(uuid())
  socialMedia	                Social
  link	                      String        @db.VarChar(2048)
  user                        User?         @relation(fields: [ownedByUserId], references: [id])
  ownedByUserId	              String?       @unique
  product                     Product?      @relation(fields: [ownedByProductId], references: [id])
  ownedByProductId            String?       @unique
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Category {
  id                          String        @id @default(uuid())
  title                       String        @db.VarChar(512)
  products                    Product[]
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Product {
  id                          String        @id @default(uuid())
  title                       String        @db.VarChar(512)
  description                 String
  price                       Decimal
  recomendedPrice             Decimal?
  minimalBid                  Decimal?
  imageLinks                  String        @db.VarChar(2048)
  city                        String?       @db.VarChar(512)
  type                        ProductType
  status                      ProductStatus
  endDate                     DateTime?
  author                      User          @relation(name: "exposedItems", fields: [authorId], references: [id])
  authorId                    String        @unique
  category                    Category?     @relation(fields: [categoryId], references: [id])
  categoryId                  String?       @unique
  winner                      User?         @relation(name: "wonItems", fields: [winnerId], references: [id])
  winnerId                    String?       @unique
  socialMedia                 SocialMedia[]
  bids                        Bid[]
  chat                        Chat?
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Bid {
  id                          String        @id @default(uuid())
  bidder                      User          @relation(fields: [bidderId], references: [id])
  bidderId                    String        @unique
  product                     Product       @relation(fields: [productId], references: [id])
  productId                   String        @unique
  price                       Decimal
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Chat {
  id	                        String        @id @default(uuid())
  title                       String        @db.VarChar(256)
  product                     Product       @relation(fields: [productId], references: [id])
  productId                   String        @unique
  members                     ChatMember[]
  messages                    Message[]
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
  deletedAt                   DateTime?     @default(now())
}

model ChatMember {
  id	                        String        @id @default(uuid())
  user                        User          @relation(fields: [userId], references: [id])
  userId                      String        @unique
  chat                        Chat          @relation(fields: [chatId], references: [id])
  chatId                      String        @unique
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

model Message {
  id	                        String        @id @default(uuid())
  sender                      User          @relation(fields: [senderId], references: [id])
  senderId                    String        @unique
  chat                        Chat          @relation(fields: [chatId], references: [id])
  chatId                      String        @unique
  text                        String
  createdAt	                  DateTime      @default(now())
  updatedAt                   DateTime      @updatedAt
}

enum Role {
  USER
  ADMIN
}

enum Themes {
  LIGHT
  DARK
}

enum Languages {
  EN
  UA
}

enum ProductType {
  AUCTION
  SELLING
}

enum ProductStatus {
  CREATED
  ACTIVE
  CANCELLED
  FINISHED
  CLOSED
  DRAFT
}

enum Social {
  FACEBOOK
  WEBSITE
  INSTAGRAM
  LINKEDIN
}
